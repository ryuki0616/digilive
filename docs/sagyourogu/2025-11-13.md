# デジタライブ・アドベンチャー 開発ログ

## 2025-11-13 作業ログ

### 1. 本日の作業概要

[cite_start]昨日のタスクであった「ElectronとPythonの連携」および「NFCカードへの書き込み機能」を実装しました [cite: 98]。
[cite_start]これにより、参加者情報を入力し、NFCカードに書き込むという「受付システム」のコア機能が完成しました [cite: 98, 120][cite_start]。また、データ設計の最適化とUI/UXの改善も併せて実施しました [cite: 107, 112]。

### 2. 主な変更点（ファイル別）

* **`nfc_writer.py` (新規作成/堅牢化)**
    * [cite_start]データ書き込み専用のPythonスクリプトとして作成・最適化しました [cite: 102, 103]。
    * [cite_start]`UTF-8` を明示的に指定し、標準入出力での文字化け（絵文字「✅」など）を解消しました [cite: 104]。
    * [cite_start]実行後5秒間のカード待機処理を追加しました [cite: 105]。
    * [cite_start]書き込み後に未使用領域をゼロクリアする機能を追加しました [cite: 106]。
* **`next.html` / `next.js`**
    * [cite_start]「NFCカードに登録」ボタンを設置しました [cite: 100]。
    * [cite_start]ボタン押下をトリガーに、IPC通信で `main.js` と連携する処理を実装しました [cite: 101]。
    * [cite_start]NFC書き込み成功後、アラートを表示し自動的に `index.html` に戻るリダイレクト機能を実装しました [cite: 116]。
* **`index.html` / `register.js`**
    * [cite_start]入力値のリアルタイム検証（名前のバイト数、年齢の範囲）を実装しました [cite: 113, 114, 115]。
    * [cite_start]条件を満たさない場合、「登録」ボタンを無効化する処理を追加しました [cite: 114, 115]。
* **`nfc_test.py`**
    * [cite_start]安全化のため、書き込み機能をコメントアウトし、「読み取り専用」のデータ確認ツールとして変更しました [cite: 117]。
* **`main.js`**
    * [cite_start]`next.js` からのIPC通信を受け取り、Pythonスクリプト `nfc_writer.py` を `child_process` で呼び出す連携機能を実装しました [cite: 85, 101, 102]。

### 3. 技術的なメモ・課題

* [cite_start]**データ設計の最適化 [cite: 107]**
    * [cite_start]**名前領域の拡張:** 参加者名（日本語）を保存するため、名前用領域を16バイトから **20バイト（5ページ分）**に拡張しました [cite: 108]。
    * [cite_start]**ステータス領域の最適化:** 各ステータスの上限を `65,535` （2バイト）とし [cite: 110][cite_start]、2つのステータス（計4バイト）をNFCカードの1ページ（4バイト）に格納する設計により、メモリ使用量を削減しました [cite: 111]。

* [cite_start]**UI/UXの改善 [cite: 112]**
    * [cite_start]`index.html` で名前のバイト数や年齢制限をリアルタイムで検証し、不備がある場合は「登録」ボタンを無効化するようにしました [cite: 114, 115]。
    * [cite_start]`next.html` でNFC書き込み成功後、自動で最初の画面 (`index.html`) に戻るフローを確立しました [cite: 116]。

### 4. 関連ドキュメント・タスク

* **関連ドキュメント:**
    * [cite_start]`要件定義書.md` （「受付システム」「ブース連携プログラム」「ランキング表示機能」） [cite: 120, 123, 124]

* **現在の状況:**
    * [cite_start]「受付システム」の基本フロー（参加者情報の入力 → NFCカードへの書き込み）が完成しました [cite: 120]。

* **今後のタスク:**
    * [cite_start]書き込み保護されていない、新品のNTAGカードでの最終書き込み検証 [cite: 122]。
    * [cite_start]「ブース連携プログラム」（ステータスの読み取り・更新）の開発 [cite: 123]。
    * [cite_start]「ランキング表示機能」の開発（Webサーバー・データベース連携） [cite: 124]。
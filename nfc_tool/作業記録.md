## 2025年11月13日 作業記録

### 1. NFCカードへの書き込み機能の実装
- **ボタンの追加**: `next.html`に「NFCカードに登録」ボタンを設置。
- **プロセス間通信**: Electronの`main.js`と`next.js`間で、書き込みリクエストと結果を安全に送受信するための通信（IPC）を実装。
- **書き込みスクリプト**: `main.js`から呼び出される、NFCカードへのデータ書き込み専用のPythonスクリプト`nfc_writer.py`を新規作成。

### 2. `nfc_writer.py` の機能改善と堅牢化
- **カード待機処理**: スクリプト実行後、最大5秒間カードがタッチされるのを待つようにし、操作性を向上。
- **文字化け修正**: 絵文字「✅」などが原因で発生していた文字化けを、`main.js`とPythonスクリプト両方で文字コードを`UTF-8`に統一することで解決。
- **データサイズの最適化**:
    - 各ステータス（所持金、パワーなど）を2バイト（0〜65535）に制限し、値の範囲チェックを追加。
    - 2つのステータスを1ページ（4バイト）に格納するようにし、カードのメモリ使用量を削減。
- **名前領域の拡張**: 日本語名（ひらがな/カタカナ/漢字）を最大6文字まで保存できるように、名前用の領域を16バイトから20バイトに拡張。
- **データクリア機能**: 書き込み後、未使用のデータ領域（13〜39ページ）をゼロでクリアし、古いデータが残らないようにした。

### 3. UI/UXの改善
- **自動リダイレクト**: NFCカードへの書き込み成功後、アラートで通知し、自動的に最初の登録画面（`index.html`）に戻るようにした。
- **入力値のリアルタイム検証 (`index.html`)**:
    - **名前**: 入力中の名前のバイト数をリアルタイムで表示し、20バイトの上限を超えると警告。上限超過時や未入力の場合は登録ボタンを押せないようにした。
    - **年齢**: 0歳から120歳までの範囲で入力されているかをチェックし、範囲外の値では登録できないようにした。
- **ボタンのスタイル調整 (`next.html`)**:
    - 「NFCカードに登録」ボタンを画面中央に配置。
    - ボタンに白い枠線を追加し、視認性を向上。

### 4. テスト用スクリプトの安全化
- `nfc_test.py`のデータ書き込み部分をコメントアウトし、カードの内容を誤って上書きする心配のない、読み取り専用の安全なデータ確認ツールに変更。
